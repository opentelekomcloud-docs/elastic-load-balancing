:original_name: elb_ug_hdg_0004.html

.. _elb_ug_hdg_0004:

Creating a Backend Server Group (Shared Load Balancers)
=======================================================

Scenario
--------

To route requests, you need to associate a backend server group to each listener.

.. note::

   This section describes how you can create a backend server group for shared load balancer.

You can create a backend server group in the ways listed in :ref:`Table 1 <elb_ug_hdg_0004__table15450757191418>`.

.. _elb_ug_hdg_0004__table15450757191418:

.. table:: **Table 1** Creating a backend server group

   +-------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+
   | Scenario                                                                | Procedure                                                                                                       |
   +=========================================================================+=================================================================================================================+
   | Creating a backend server group and associating it with a load balancer | :ref:`Procedure <elb_ug_hdg_0004__en-us_topic_0000001383606924_section92351821132217>`                          |
   +-------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+
   | Creating a backend server group when adding a listener                  | You can add listeners using different protocols as required. For details, see :ref:`Overview <elb_ug_jt_0001>`. |
   |                                                                         |                                                                                                                 |
   |                                                                         | References are as follows:                                                                                      |
   |                                                                         |                                                                                                                 |
   |                                                                         | -  :ref:`Adding a TCP Listener <elb_ug_jt_0006>`                                                                |
   |                                                                         | -  :ref:`Adding a UDP Listener <elb_ug_jt_0007>`                                                                |
   |                                                                         | -  :ref:`Adding an HTTP Listener <elb_ug_jt_0008>`                                                              |
   |                                                                         | -  :ref:`Adding an HTTPS Listener <elb_ug_jt_0009>`                                                             |
   +-------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+
   | Changing the backend server group associated with the listener          | :ref:`Changing a Backend Server Group <elb_ug_hdg_0006>`                                                        |
   +-------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+

Constraints
-----------

-  The backend protocol of the new backend server group must match the frontend protocol of the listener as described in :ref:`Table 3 <elb_ug_hdg_0001__table89265491950>`.
-  The backend server group of a shared load balancer can be associated with only one listener.

.. _elb_ug_hdg_0004__en-us_topic_0000001383606924_section92351821132217:

Procedure
---------

#. Log in to the management console.

#. In the upper left corner of the page, click |image1| and select the desired region and project.

#. Click |image2| in the upper left corner to display **Service List** and choose **Network** > **Elastic Load Balancing**.

#. In the navigation pane on the left, choose **Elastic Load Balancing** > **Backend Server Groups**.

#. Click **Create Backend Server Group** in the upper right corner.

#. Configure the routing policy based on :ref:`Table 2 <elb_ug_hdg_0004__table17921104011492>`.

   .. _elb_ug_hdg_0004__table17921104011492:

   .. table:: **Table 2** Parameters required for configuring a routing policy

      +---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Parameter                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                    | Example Value         |
      +===========================+================================================================================================================================================================================================================================================================================================================================================================================================================================+=======================+
      | Load Balancing Type       | Specifies the type of load balancers that can use the backend server group.                                                                                                                                                                                                                                                                                                                                                    | Shared                |
      +---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Load Balancer             | Specifies whether to associate a load balancer.                                                                                                                                                                                                                                                                                                                                                                                | N/A                   |
      +---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Backend Server Group Name | Specifies the name of the backend server group.                                                                                                                                                                                                                                                                                                                                                                                | server_group          |
      +---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Backend Protocol          | Specifies the protocol that backend servers in the backend server group use to receive requests from the listeners. The protocol varies depending on the forwarding mode:                                                                                                                                                                                                                                                      | HTTP                  |
      |                           |                                                                                                                                                                                                                                                                                                                                                                                                                                |                       |
      |                           | The options are HTTP, TCP, and UDP.                                                                                                                                                                                                                                                                                                                                                                                            |                       |
      +---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Load Balancing Algorithm  | Specifies the algorithm used by the load balancer to distribute traffic. The following options are available:                                                                                                                                                                                                                                                                                                                  | Weighted round robin  |
      |                           |                                                                                                                                                                                                                                                                                                                                                                                                                                |                       |
      |                           | -  **Weighted round robin**: Requests are routed to different servers based on their weights. Backend servers with higher weights receive proportionately more requests, whereas equal-weighted servers receive the same number of requests.                                                                                                                                                                                   |                       |
      |                           | -  **Weighted least connections**: In addition to the number of connections, each server is assigned a weight based on its capacity. Requests are routed to the server with the lowest connections-to-weight ratio.                                                                                                                                                                                                            |                       |
      |                           | -  **Source IP hash**: Allows requests from different clients to be routed based on source IP addresses and ensures that requests from the same client are forwarded to the same server.                                                                                                                                                                                                                                       |                       |
      |                           |                                                                                                                                                                                                                                                                                                                                                                                                                                |                       |
      |                           | For more information about load balancing algorithms, see :ref:`Load Balancing Algorithms <elb_ug_jt_0003>`.                                                                                                                                                                                                                                                                                                                   |                       |
      +---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Sticky Sessions           | If you enable sticky sessions, all requests from the same client during one session are sent to the same backend server.                                                                                                                                                                                                                                                                                                       | N/A                   |
      |                           |                                                                                                                                                                                                                                                                                                                                                                                                                                |                       |
      |                           | For more information about sticky sessions, see :ref:`Sticky Session <elb_ug_jt_0004>`.                                                                                                                                                                                                                                                                                                                                        |                       |
      +---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Sticky Session Type       | Specifies the type of sticky sessions. After the sticky session is enabled, you need to select a sticky session type:                                                                                                                                                                                                                                                                                                          | Source IP address     |
      |                           |                                                                                                                                                                                                                                                                                                                                                                                                                                |                       |
      |                           | -  **Source IP address**: The source IP address of each request is calculated using the consistent hashing algorithm to obtain a unique hashing key, and all backend servers are numbered. The system allocates the client to a particular server based on the generated key. This enables requests from different clients to be routed and ensures that a client is directed to the same server that it was using previously. |                       |
      |                           | -  **Load balancer cookie**: The load balancer generates a cookie after receiving a request from the client.                                                                                                                                                                                                                                                                                                                   |                       |
      |                           | -  **Application cookie**: The application deployed on the backend server generates a cookie after receiving the first request from the client. All subsequent requests with the same cookie are routed to the same backend server.                                                                                                                                                                                            |                       |
      |                           |                                                                                                                                                                                                                                                                                                                                                                                                                                |                       |
      |                           | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                      |                       |
      |                           |                                                                                                                                                                                                                                                                                                                                                                                                                                |                       |
      |                           |    -  **Source IP address** is available when you have selected **TCP** or **UDP** for **Backend Protocol**.                                                                                                                                                                                                                                                                                                                   |                       |
      |                           |    -  **Load balancer cookie** is available when you have selected **HTTP** or **HTTPS** for **Backend Protocol**.                                                                                                                                                                                                                                                                                                             |                       |
      +---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Stickiness Duration (min) | Specifies the time that sticky sessions are maintained, in minutes.                                                                                                                                                                                                                                                                                                                                                            | 20                    |
      |                           |                                                                                                                                                                                                                                                                                                                                                                                                                                |                       |
      |                           | -  Sticky sessions at Layer 4: **1** to **60**                                                                                                                                                                                                                                                                                                                                                                                 |                       |
      |                           | -  Sticky sessions at Layer 7: **1** to **1440**                                                                                                                                                                                                                                                                                                                                                                               |                       |
      +---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Description               | Provides supplementary information about the backend server group.                                                                                                                                                                                                                                                                                                                                                             | N/A                   |
      +---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+

#. Click **Next** to add backend servers and configure health check based on :ref:`Table 3 <elb_ug_hdg_0004__en-us_topic_0000001383606924_table11861154278>`. For more information about health checks, see :ref:`Health Check <elb_ug_hc_0001>`.

   .. _elb_ug_hdg_0004__en-us_topic_0000001383606924_table11861154278:

   .. table:: **Table 3** Parameters required for configuring a health check

      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Parameter             | Description                                                                                                                                                                                                                                                                                             | Example Value         |
      +=======================+=========================================================================================================================================================================================================================================================================================================+=======================+
      | Health Check          | Specifies whether to enable health checks.                                                                                                                                                                                                                                                              | N/A                   |
      |                       |                                                                                                                                                                                                                                                                                                         |                       |
      |                       | If the health check is enabled, click |image3| next to **Advanced Settings** to set health check parameters.                                                                                                                                                                                            |                       |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Health Check Protocol | -  The health check protocol can be TCP or HTTP.                                                                                                                                                                                                                                                        | HTTP                  |
      |                       | -  If the protocol of the backend server group is UDP, the health check protocol is UDP by default.                                                                                                                                                                                                     |                       |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Domain Name           | Specifies the domain name that will be used for health checks. By default, the private IP address of each backend server is used.                                                                                                                                                                       | www.elb.com           |
      |                       |                                                                                                                                                                                                                                                                                                         |                       |
      |                       | A domain name consists of at least two character strings separated by periods (.). The total length of a domain name cannot exceed 100 characters with each character string not exceeding 63 characters. Only letters, digits, and hyphens (-) are allowed. Strings cannot start or end with a hyphen. |                       |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Health Check Port     | Specifies the port that will be used by the load balancer to check the health of backend servers. The port number ranges from **1** to **65535**.                                                                                                                                                       | 80                    |
      |                       |                                                                                                                                                                                                                                                                                                         |                       |
      |                       | .. note::                                                                                                                                                                                                                                                                                               |                       |
      |                       |                                                                                                                                                                                                                                                                                                         |                       |
      |                       |    By default, the service port on each backend server is used. You can also specify a port for health checks.                                                                                                                                                                                          |                       |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Path                  | Specifies the health check URL, which is the destination on backend servers for health checks. The path can contain 1 to 80 characters and must start with a slash (/).                                                                                                                                 | /index.html           |
      |                       |                                                                                                                                                                                                                                                                                                         |                       |
      |                       | The path can contain letters, digits, hyphens (-), slashes (/), periods (.), question marks (?), number signs (#), percent signs (%), ampersands (&).                                                                                                                                                   |                       |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Interval (s)          | Specifies the maximum time between two consecutive health checks, in seconds.                                                                                                                                                                                                                           | 5                     |
      |                       |                                                                                                                                                                                                                                                                                                         |                       |
      |                       | The interval ranges from **1** to **50**.                                                                                                                                                                                                                                                               |                       |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Timeout (s)           | Specifies the maximum time required for waiting for a response from the health check, in seconds. The interval ranges from **1** to **50**.                                                                                                                                                             | 3                     |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Maximum Retries       | Specifies the maximum number of health check retries. The value ranges from **1** to **10**.                                                                                                                                                                                                            | 3                     |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+

#. Click **Next**.

#. Confirm the specifications and click **Create Now**.

.. |image1| image:: /_static/images/en-us_image_0000001747739624.png
.. |image2| image:: /_static/images/en-us_image_0000001747739748.png
.. |image3| image:: /_static/images/en-us_image_0000001747739800.png
